<!DOCTYPE html>
<html class="no-js" lang="en">
<head>

    <!--- basic page needs
    ================================================== -->
    <meta charset="utf-8">
    <title>Standard Post - Abstract</title>
    <meta name="description" content="">
    <meta name="author" content="">

   <!-- mobile specific metas
    ================================================== -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS
    ================================================== -->
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/vendor.css">

    <!-- script
    ================================================== -->
    <script src="/modernizr.js"></script>
    <!-- --------- Owl-Carousel ------------------->
    <link rel="stylesheet" href="/owl.carousel.min.css">
    <link rel="stylesheet" href="/owl.theme.default.min.css">
    <!-- favicons
    ================================================== -->
    <link rel="apple-touch-icon" sizes="180x180" href="/img-favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img-favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img-favicon/favicon-16x16.png">
    <link rel="manifest" href="#">

</head>

<body id="top">


    <!-- preloader
    ================================================== -->
    <div id="preloader">
        <div id="loader"></div>
    </div>


    <!-- header
    ================================================== -->
    <header class="s-header">

        <div class="row s-header__content">

            <div class="s-header__logo">
                <a class="logo" href="/user/home">
                    <img src="/images/logo.svg" alt="Homepage">
                </a>
            </div>

            <nav class="s-header__nav-wrap">

                <h2 class="s-header__nav-heading h6">Site Navigation</h2>

                <ul class="s-header__nav">
                    <li><a href="/user/home" title="">Home</a></li>
                    <li class="has-children">
                        <a href="#0" title="">Animal</a>
                        <ul class="sub-menu">
                            <li><a href="/blogs/category/1">Động vật có vú</a></li>
                            <li><a href="/blogs/category/2">Động vật có vỏ</a></li>
                            <li><a href="/blogs/category/3">Động vật không có xương sống</a></li>
                            <li><a href="/blogs/category/4">Chim</a></li>
                            <li><a href="/blogs/category/5">Cá</a></li>
                            <li><a href="/blogs/category/6">Lưỡng Cư</a></li>
                            <li><a href="/blogs/category/7">Côn Trùng</a></li>
                            <li><a href="/blogs/category/8">Giáp Xác</a></li>
                            
                        </ul>
                    </li>
                    <li><a href="/blogs/new/<%= user._id %>" title="">New Blog</a></li>
                    <!-- <li><a href="/user/<%= user._id %>/myBlogs" title="">My Blog</a></li> -->
                    <li><a href="/user/<%= user._id %>" title="">Profile</a></li>
                    
                    <li><a href="/user/about" title="">About</a></li>
                    <li><a href="/user/contact" title="">Contact</a></li>
                    <li><a href="/user/cart/<%= user._id%>">Cart </a> </li>
                    <li><a href="/user/addmoney/<%= user._id%>">Add money</a></li>
                </ul> <!-- end header__nav -->

                <a href="#0" title="Close Menu" class="s-header__overlay-close close-mobile-menu">Close</a>

            </nav> <!-- end header__nav-wrap -->
            
            <a class="s-header__toggle-menu" href="#0" title="Menu"><span>Menu</span></a>
            
             
            <div class="s-header__search">
                    
                <label>
                    <form action="/blogs/search" method="post"class="s-header__search-form">
                        <input type="hidden" id="userID" class="userID" name="userID" value="<%= user._id %>">
                        <span class="hide-content">Search for:</span>
                        <input type="search" id="search" class="s-header__search-field" placeholder="Type Your Keywords" value="" name="search" title="Search for:" autocomplete="off">
                        <!-- <button type="submit">Search</button> -->
                    </form>
                      
                </label> 

                <a href="/user/home" title="Close Search" class="s-header__overlay-close">Close</a>

            </div> <!-- end search wrap -->	
                   
            <a class="s-header__toggle-menu" href="#0" title="Menu"><span>Menu</span></a>
            
            <div class="s-header__search">
                    
                <form role="search" method="get" class="s-header__search-form" action="#">
                    <label>
                        <span class="hide-content">Search for:</span>
                        <input type="search" class="s-header__search-field" placeholder="Type Your Keywords" value="" name="s" title="Search for:" autocomplete="off">
                    </label>
                    <input type="submit" class="s-header__search-submit" value="Search">
                </form>

                <a href="#0" title="Close Search" class="s-header__overlay-close">Close</a>

            </div> <!-- end search wrap -->	

            <a class="s-header__search-trigger" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 18a7.952 7.952 0 004.897-1.688l4.396 4.396 1.414-1.414-4.396-4.396A7.952 7.952 0 0018 10c0-4.411-3.589-8-8-8s-8 3.589-8 8 3.589 8 8 8zm0-14c3.309 0 6 2.691 6 6s-2.691 6-6 6-6-2.691-6-6 2.691-6 6-6z"></path></svg>
            </a>

        </div> <!-- end s-header__content -->

    </header> <!-- end header -->


    <!-- content
    ================================================== -->
    <section class="s-content s-content--single">
        <div class="row">
            <div class="column large-12">

                <article class="s-post entry format-standard">

                    <div class="s-content__media">
                        <div class="s-content__post-thumb">
                           <img src="data:<%= blog.img.contentType %>;base64,<%= blog.img.data.toString('base64') %>" class="card-img" alt="...">
                        </div>
                    </div> <!-- end s-content__media -->

                    <div class="s-content__primary">

                        <h2 class="s-content__title s-content__title--post"><%= blog.title %></h2>

                        <ul class="s-content__post-meta">
                            <li class="date"><%= blog.timeCreated.toLocaleDateString() %></li>
                            <li class="cat"><a href=""><%= blog.author %></a></li>
                        </ul>

                        <p class="lead">
                            <%- blog.description %> </p> 

                        <p>
        
                        <p class="s-content__post-tags"Tags:>
                            <span>Tagged in :</span>
                            <!--<a href="#">orci</a><a href="#">lectus</a><a href="#">varius</a><a href="#">turpis</a> -->
                             <%= blog.tags %>
                        </p>


                        <div class="s-content__pagenav group">
                            <div class="prev-nav">
                                <a href="#" rel="prev">
                                    <span>Previous</span>
                                    Tips on Minimalist Design 
                                </a>
                            </div>
                             <div class="next-nav">
                                 <a href="#" rel="next">
                                     <span>Next</span>
                                    Less Is More 
                                 </a>
                             </div>
                         </div> <!-- end s-content__pagenav -->

                    </div> <!-- end s-content__primary -->
                </article>

            </div> <!-- end column -->
        </div> <!-- end row -->

        <!--Related blogs-->
        
          <div class="container">
            <h2>Related Blogs</h2>
            <div class="owl-carousel owl-theme blog-post">
              <% relatedBlogs.forEach(relatedBlog => { %>
                <div class="blog-content" data-aos="fade-right" data-aos-delay="200">
                    <img src="data:<%= relatedBlog.img.contentType %>;base64,<%= relatedBlog.img.data.toString('base64') %>" class="img" alt="...">
                  <div class="blog-title">
                    <h3><%= relatedBlog.title %></h3>
                    <h4><%= relatedBlog.author %></h4>
                    <p><%- relatedBlog.introduction %></p>
                    <button onclick="window.location.href = '/blogs/<%=relatedBlog.slug %>';" class="btn btn-blog">Read more</button>
                  </div>
                </div>
              <% }) %>
            </div>
                <div class="owl-navigation">
                    <span class="owl-nav-prev"><i class="fas fa-long-arrow-alt-left"></i></span>
                    <span class="owl-nav-next"><i class="fas fa-long-arrow-alt-right"></i></span>
                </div>
        </div>
        <!-- comments
        ================================================== -->
        <div class="comments-wrap">
            <div id="comments" class="row">
                <div class="column">
                    <h3><%= blog.comments.length %> Comments</h3>
                    <ol class="commentlist">
                        <% if (blog.comments.length === 0) { %>
                            <p>There are no comments, create one.</p>
                        <% } else { %>
                            <% blog.comments.forEach(comment => { %>
                                <li class="depth-1 comment">
                                    <div class="comment__avatar">
                                        <% console.log(comment.commentBy); %>
                                        <% if (comment.commentBy && comment.commentBy.avatarimg) { %>
                                            <% console.log(comment.commentBy.avatarimg); %>
                                            <img class="avatar" src="data:<%= comment.commentBy.avatarimg.contentType %>;base64,<%= comment.commentBy.avatarimg.data.toString('base64') %>" alt="..." width="50" height="50">
                                        <% } else { %>
                                            <!-- Không có hình ảnh avatar -->
                                            <div class="no-avatar">No Avatar</div>
                                        <% } %>
                                    </div>
                                    <div class="comment__content">
                                        <div class="comment__info">
                                            <% if (comment.commentBy) { %>
                                                <div class="comment__author"><%= comment.commentBy.username %></div>
                                                <div class="comment__meta">
                                                    <div class="comment__time"><%= comment.createDate.toDateString() %></div>
                                                </div>
                                            <% } else { %>
                                                <div class="comment__author">Unknown Author</div>
                                                <div class="comment__meta">
                                                    <div class="comment__time"><%= comment.createDate.toDateString() %></div>
                                                </div>
                                            <% } %>
                                        </div>
                                        
                                        <div class="comment__text">
                                            <p><%= comment.content %></p>
                                        </div>
                                    </div>
                                </li> <!-- end comment level 1 -->
                            <% }); %>
                        <% } %>
                    </ol>
                </div> <!-- end col-full -->
            </div> <!-- end comments -->
        </div>

            <div class="row comment-respond">

                <!-- START respond -->
                <div id="respond" class="column">

                    <h3>Add Comment</h3>

                    <form id="comment-form">
                        <fieldset>
                            <textarea id="comment-content" placeholder="Your comment" required></textarea>
                            <input id="submit" class="btn btn--primary btn-wide btn--large h-full-width" value="Add Comment" type="submit">
                        </fieldset>
                    </form>

                    


                </div>
                <!-- END respond-->

            </div> <!-- end comment-respond -->

        </div> <!-- end comments-wrap -->

    </section> <!-- end s-content -->


    <!-- footer
    ================================================== -->
    <footer class="s-footer">

        <div class="s-footer__main">

            <div class="row">

                <div class="column large-4 medium-6 tab-12 s-footer__info">

                    <h5>About Our Site</h5>

                    <p>
                        Trang web của chúng tôi là một dự án học tập và đam mê, được xây dựng bởi những con người đam mê về công nghệ và yêu thương động vật. Chúng tôi hi vọng rằng trang web sẽ mang đến sự hiểu biết về thế giới động vật và tạo cơ hội cho mọi người kết nối và chia sẻ đam mê của họ về động vật.                        </p>

                </div> <!-- end s-footer__info -->

                <div class="column large-4 medium-6 tab-12 s-footer__site-links">

                    <h5>Site Links</h5>

                    <ul>
                        <li><a href="#0">About Us</a></li>
                        <li><a href="#0">Blog</a></li>
                        <li><a href="#0">FAQ</a></li>
                        <li><a href="#0">Terms</a></li>
                        <li><a href="#0">Privacy Policy</a></li>
                    </ul>

                </div> <!-- end s-footer__site-links -->  

                <div class="column large-4 medium-6 tab-12 s-footer__social-links">

                    <h5>Social</h5>

                    <ul>
                        <li><a href="#0">Twitter</a></li>
                        <li><a href="https://www.facebook.com/profile.php?id=100071044693606">Facebook</a></li>
                        <!-- <li><a href="#0">Dribbble</a></li>
                        <li><a href="#0">Pinterest</a></li> -->
                        <li><a href="#0">Instagram</a></li>
                    </ul>

                </div> <!-- end s-footer__social links --> 

                <!-- <div class="column large-4 medium-12 s-footer__subscribe">

                    <h5>Subscribe</h5>

                    <p>Keep yourself updated. Subscribe to our newsletter.</p>

                    <div class="subscribe-form">
                
                        <form id="mc-form" class="group" novalidate="true">

                            <input type="email" value="" name="dEmail" class="email" id="mc-email" placeholder="Type &amp; press enter" required=""> 
                
                            <input type="submit" name="subscribe" >
                
                            <label for="mc-email" class="subscribe-message"></label>
                
                        </form>

                    </div>

                </div>  -->

            </div> <!-- end row -->

        </div> <!-- end s-footer__main -->

        <div class="s-footer__bottom">
            <div class="row">
                <div class="column">
                    <div class="ss-copyright">
                        <span>© Copyright Abstract 2023</span> 
                        <span>Design by <a href="https://www.facebook.com/profile.php?id=100071044693606">Web developers</a></span>		         	
                    </div> <!-- end ss-copyright -->
                </div>
            </div> 
            <div class="ss-go-top">
                <a class="smoothscroll" title="Back to Top" href="#top">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 4h12v2H6zm5 10v6h2v-6h5l-6-6-6 6z"/></svg>
                </a>
            </div> <!-- end ss-go-top -->
        </div> <!-- end s-footer__bottom -->

   </footer> <!-- end s-footer -->


  <!-- Java Script
   ================================================== --> 
   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <script src="/plugins.js"></script>
   <script src="/main.js"></script>
   <!-- --------- Owl-Carousel js ------------------->
   <script src="/owl.carousel.min.js"></script>
   <script>
    $(document).ready(function() {
        console.log('Document is ready');
        $('.owl-carousel').owlCarousel({
            items: 1,
            loop: true,
            nav: true,
            navText: ['<i class="fas fa-long-arrow-alt-left"></i>', '<i class="fas fa-long-arrow-alt-right"></i>'],
        });

        $('#comment-form').submit(function(event) {
            console.log('Form submitted');
            event.preventDefault();

            const content = $('#comment-content').val();
            const blogSlug = '<%= blog.slug %>'; // Assuming 'blog' is passed to the template

            $.ajax({
                url: `/blogs/add-comment/${blogSlug}`,
                type: 'POST',
                data: { content: content },
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        // Create HTML for the new comment
                        const newCommentHTML = `
                            <li class="depth-1 comment">
                                <div class="comment__avatar">
                                    <% if (user && user.avatarimg) { %>
                                        <img class="avatar" src="data:<%= user.avatarimg.contentType %>;base64,<%= user.avatarimg.data.toString('base64') %>" alt="..." width="50" height="50">
                                    <% } else { %>
                                        <!-- No Avatar -->
                                        <div class="no-avatar">No Avatar</div>
                                    <% } %>
                                </div>
                                <div class="comment__content">
                                    <div class="comment__info">
                                        <% if (user) { %>
                                            <div class="comment__author"><%= user.username %></div>
                                            <div class="comment__meta">
                                                <div class="comment__time"><%= new Date().toDateString() %></div>
                                            </div>
                                        <% } else { %>
                                            <div class="comment__author">Unknown Author</div>
                                            <div class="comment__meta">
                                                <div class="comment__time"><%= new Date().toDateString() %></div>
                                            </div>
                                        <% } %>
                                    </div>
                                    <div class="comment__text">
                                        <p>${content}</p>
                                    </div>
                                </div>
                            </li>`;
                
                        // Append the new comment to the comments list
                        $('.commentlist').append(newCommentHTML);
                        $('#comment-content').val(''); // Clear the comment input field
                        console.log('Comment added successfully:', content);
                    } else {
                        console.error('Error:', response.error);
                    }
                },
                
                  
                error: function(xhr, status, error) {
                  console.error('AJAX Error:', error);
                }
              });
        });
    });
   </script>
</body>
</html>
